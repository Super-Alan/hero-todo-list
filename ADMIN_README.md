# 管理端使用说明

## 🎯 功能概述

本系统现已支持管理端功能，提供完整的用户和模型提供商管理能力。

## 🚀 快速开始

### 1. 创建管理员账户

```bash
npm run create-admin
```

这将创建一个默认的管理员账户：
- 📧 邮箱: `admin@example.com`
- 🔑 密码: `admin123456`

### 2. 访问管理端

访问 `/admin` 路径即可进入管理端。

## 🔐 权限控制

### 用户角色

- **USER**: 普通用户，只能使用基本功能
- **ADMIN**: 管理员，可以访问管理端所有功能

### 管理端路由保护

所有 `/admin/*` 路由都受到保护：
- 需要用户已登录
- 需要用户角色为 `ADMIN`
- 未授权访问将被重定向

## 📱 管理端功能

### 1. 仪表板 (`/admin`)
- 系统概览和关键指标
- 用户统计、模型提供商统计
- 最近注册用户和任务活动
- 数据可视化图表

### 2. 用户管理 (`/admin/users`)
- 查看所有用户列表
- 搜索和筛选用户
- 修改用户角色 (USER ↔ ADMIN)
- 删除用户账户
- 查看用户数据统计（任务数、标签数等）

### 3. 模型提供商管理 (`/admin/model-providers`)
- 查看所有模型提供商
- 添加新的模型提供商
- 编辑现有提供商配置
- 启用/禁用提供商
- 删除提供商
- 安全的API密钥管理（部分隐藏显示）

### 4. 统计分析 (`/admin/stats`)
- 系统使用统计
- 用户增长趋势
- 任务完成情况
- 模型提供商活跃度

## 🛡️ 安全特性

### API安全
- 所有管理端API (`/api/admin/*`) 都需要管理员权限
- 统一的权限检查中间件
- 详细的错误日志记录

### 数据保护
- API密钥在前端显示时部分隐藏
- 敏感操作需要确认
- 防止管理员删除自己的账户

### 会话管理
- NextAuth.js 集成角色信息
- 自动权限刷新
- 安全的会话存储

## 🔧 技术架构

### 后端
- **权限中间件**: `/src/lib/auth-utils.ts`
- **管理API**: `/src/app/api/admin/*`
- **数据库模型**: 扩展了User模型添加role字段

### 前端
- **权限守卫**: `AdminGuard` 组件
- **管理布局**: 独立的管理端布局
- **响应式设计**: 支持桌面和移动端访问

### 数据库
- **Role枚举**: `USER`, `ADMIN`
- **用户表**: 添加了 `role` 字段，默认为 `USER`
- **向后兼容**: 现有用户自动设为普通用户

## 📝 使用提示

1. **首次部署**：运行 `npm run create-admin` 创建管理员
2. **添加管理员**：在用户管理页面修改用户角色为ADMIN
3. **模型配置**：确保模型提供商配置正确的API端点和密钥
4. **安全建议**：定期更改管理员账户密码

## 🚨 注意事项

- 管理员账户拥有系统最高权限，请谨慎使用
- 删除用户会级联删除其所有数据（任务、标签、评论）
- 模型提供商的API密钥存储在数据库中，请确保数据库安全
- 建议在生产环境中修改默认管理员密码

## 🔄 系统影响

管理端功能的实现采用了最小侵入性设计：
- ✅ 不影响现有用户功能
- ✅ 不改变现有API行为
- ✅ 不影响现有数据结构
- ✅ 完全向后兼容

现有用户可以继续正常使用系统，管理功能通过独立路由提供。